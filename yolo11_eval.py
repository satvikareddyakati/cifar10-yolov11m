# -*- coding: utf-8 -*-
"""YOLO11_eval.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1MhTf9UIl8zYGKnJ-Vq4v6wr-0yaAksAS
"""

from ultralytics import YOLO
import csv
import os

# Load the trained model
model = YOLO("/Users/satvikaakati/Desktop/yolo_project/runs/classify/train2/weights/best.pt")

# Paths
data_root = "/Users/satvikaakati/datasets/cifar10"
train_results_csv = "/Users/satvikaakati/Desktop/yolo_project/runs/classify/train2/results.csv"

def read_best_val_metrics(csv_path):
    best_top1 = None
    best_top5 = None
    if not os.path.exists(csv_path):
        return None, None
    with open(csv_path, "r", newline="") as f:
        reader = csv.DictReader(f)
        for row in reader:
            try:
                top1 = float(row.get("metrics/accuracy_top1", "nan"))
                top5 = float(row.get("metrics/accuracy_top5", "nan"))
            except ValueError:
                continue
            if best_top1 is None or top1 > best_top1:
                best_top1 = top1
                best_top5 = top5
    return best_top1, best_top5

# Evaluate training-set accuracy
train_metrics = model.val(data=data_root, split="train", imgsz=160, device='mps')

# Evaluate test-set accuracy
test_metrics = model.val(data=data_root, split="test", imgsz=160, device='mps')

# Read best validation accuracy from training logs
val_top1, val_top5 = read_best_val_metrics(train_results_csv)

print({
    "train_top1": float(train_metrics.top1),
    "train_top5": float(train_metrics.top5),
    "val_top1_best": float(val_top1) if val_top1 is not None else None,
    "val_top5_best": float(val_top5) if val_top5 is not None else None,
    "test_top1": float(test_metrics.top1),
    "test_top5": float(test_metrics.top5),
})